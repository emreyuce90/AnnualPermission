@model List<EmployeeListDto>

<div class="text-center">
    <h2 class=""><i class="fas fa-address-card"></i> Çalışanlar </h2>
</div>
<div class="text-center  mt-4">
    <a class="btn btn-success" asp-action="AddEmployee" asp-controller="Employee">
        <i class="fas fa-user-plus p-1"></i>Yeni Çalışan Ekle
    </a>
</div>

<table class="table table-striped  table-responsive table-hover ">
    <thead class="thead-inverse">
        <tr>

            <th>Plasiyer Id</th>
            <th>Plasiyer Adı</th>
            <th>Plasiyer Soyadı</th>
            <th>Plasiyer Ünvanı</th>
            <th>İşe Giriş Tarihi</th>
            <th>Çalışma Zamanı</th>
            <th>Kanuni izin hakkı</th>
            <th>Kullandığı İzinler</th>
            
            <th>İşlemler</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            <tr>

                <td>@item.Id</td>
                <td>@item.Name</td>
                <td>@item.Surname</td>
                <td>@item.Title</td>
                <td>@item.EnterDate.ToString("yyyy")</td>
                <td>@(DateTime.Now.Year - item.EnterDate.Year) YIL</td>
                @{
                    if ((DateTime.Now.Year - item.EnterDate.Year) <= 1)
                    {
                        <td>0 GÜN</td>
                    }
                    else if ((DateTime.Now.Year - item.EnterDate.Year <= 5))
                    {
                        <td>14 GÜN</td>

                    }
                    else if ((DateTime.Now.Year - item.EnterDate.Year) > 5)
                    {
                        <td>20 GÜN</td>
                    }
                    else
                    {
                        <td>26 GÜN</td>
                    }
                }
                    <permission-year-count employee-id="@item.Id">
                    </permission-year-count>
                                            
                   

                <td>
                    <a class="text-info"asp-controller='Permission' asp-action='GetPermissionList' asp-route-id='@item.Id'><i class='fas fa-info-circle'></i></a>
                    <a  asp-controller="Permission" asp-action="AddPermission" class="btn btn-warning btn-sm text-white" asp-route-id="@item.Id"><i class="fas fa-plus p-1"></i></a>
                    <a class="btn btn-info btn-sm text-white" asp-action="UpdateEmployee" asp-route-id="@item.Id"
                    asp-controller="Employee"><i class="fas fa-edit p-1"></i></a>
                    <a asp-controller="Employee" data-bs-toggle="modal" data-bs-target="#myModal"
                    asp-action="DeleteEmployee" asp-route-id="@item.Id" data-employee="@item.Id"
                    class="btn btn-danger"><i class="fas fa-trash-alt p-1"></i></a>

                </td>


            </tr>
        }

    </tbody>
</table>


<div class="modal" tabindex="-1" id="myModal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">UYARI</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Bu kaydı silmek istediğinizden emin misiniz ?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" data-bs-dismiss="modal"><i
                        class="fas fa-times-circle p-1"></i>Hayır</button>
                <button type="button" class="btn btn-primary"><i class="fas fa-check-circle p-1"
                        id="btnSil"></i>Evet</button>
            </div>
        </div>
    </div>
</div>





@section Javascript{
<script type="text/javascript">
    $(document).ready(function () {
        $("#myModal").on('shown.bs.modal', function (event) {
            let btn = $(event.relatedTarget);
            let id =btn.data('employee');
            $("#btnSil").click(function(){
                $.ajax({
                    type:"get",
                    url:"./Employee/DeleteEmployee/"+id,
                    
                    contentType:"application/json;charset=utf-8;",
                    success:function(){
                        window.location.reload();
                    },
                    error: function(err){
                        console.log(err.statusText);
                        alert(err.statusText);
                    }
                });
            });
        });
    });
</script>
}